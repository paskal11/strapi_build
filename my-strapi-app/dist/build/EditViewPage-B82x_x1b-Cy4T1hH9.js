import{aq as N,aP as O,u as k,o as q,cF as G,cI as Q,cC as U,r as C,j as e,P as d,bb as Y,_,ey as H,ez as $,eA as m,eB as j,S as c,eC as J,eD as K,d as W,bo as X,v as Z,cA as ee,F as P,B as te,eE as se,cz as ae}from"./strapi-Ck8xygrr.js";import{a as ne,f as ie,t as re,g as I}from"./Field-DufHXW17-BbhXD60z.js";import"./Relations-BTcf5xaw-rQvt2dcc.js";import"./useDragAndDrop-DdHgKsqq-BBumwmAx.js";import"./relations-C0w0GcXi-ClclJxKj.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-Ck4uOr5H.js";import"./objects-mKMAmfec-BH4aJvIm.js";import"./useDebounce-DmuSJIF3-DlLvAKyd.js";const oe=a=>C.useEffect(a,de),de=[],S=({layout:a})=>e.jsx(P,{direction:"column",alignItems:"stretch",gap:6,children:a.map((n,o)=>{if(n.some(s=>s.some(t=>t.type==="dynamiczone"))){const[s]=n,[t]=s;return e.jsx(c.Root,{gap:4,children:e.jsx(c.Item,{col:12,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(I,{...t})})},t.name)}return e.jsx(te,{hasRadius:!0,background:"neutral0",shadow:"tableShadow",paddingLeft:6,paddingRight:6,paddingTop:6,paddingBottom:6,borderColor:"neutral150",children:e.jsx(P,{direction:"column",alignItems:"stretch",gap:6,children:n.map((s,t)=>e.jsx(c.Root,{gap:4,children:s.map(({size:r,...u})=>e.jsx(c.Item,{col:r,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(I,{...u})},u.name))},t))})},o)})}),ce=()=>{const a=N(),[{query:{status:n}},o]=O({status:"draft"}),{formatMessage:s}=k(),{toggleNotification:t}=q(),{document:r,meta:u,isLoading:R,schema:l,components:g,collectionType:T,id:v,model:D,hasError:A}=G(),p=l?.options?.draftAndPublish??!1;oe(()=>{a?.state&&"error"in a.state&&t({type:"danger",message:a.state.error,timeout:5e3})});const B=Q("EditViewPage",i=>i.isLoading),x=T===se,h=!v&&!x,{isLoading:F,edit:{layout:b,settings:{mainField:f}}}=U(D),{isLazyLoading:M}=ne([]),w=B||R||F||M,L=C.useMemo(()=>{if(!r&&!h&&!x||!l)return;const i=r?.id?r:ie(l,g);return re(l,g)(i)},[r,h,x,l,g]);if(A)return e.jsx(d.Error,{});if(w&&!r?.documentId)return e.jsx(d.Loading,{});if(!L)return e.jsx(d.Error,{});const z=i=>{(i==="published"||i==="draft")&&o({status:i},"push",!0)},y=f!=="id"&&r?.[f]?r[f]:"Untitled";return e.jsxs(Y,{paddingLeft:10,paddingRight:10,children:[e.jsx(d.Title,{children:`${y}`}),e.jsx(_,{disabled:p&&n==="published",initialValues:L,method:h?"POST":"PUT",validate:(i,V)=>H(l?.attributes,g,{status:n,...V}).validate(i,{abortEarly:!1}),children:({resetForm:i})=>e.jsxs(e.Fragment,{children:[e.jsx($,{isCreating:h,status:p?ue(r,u):void 0,title:y}),e.jsxs(m.Root,{variant:"simple",value:n,onValueChange:z,children:[e.jsx(m.List,{"aria-label":s({id:j("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:p?e.jsxs(e.Fragment,{children:[e.jsx(E,{value:"draft",children:s({id:j("containers.edit.tabs.draft"),defaultMessage:"draft"})}),e.jsx(E,{disabled:!u||u.availableStatus.length===0,value:"published",children:s({id:j("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),e.jsxs(c.Root,{paddingTop:8,gap:4,children:[e.jsxs(c.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[e.jsx(m.Content,{value:"draft",children:e.jsx(S,{layout:b})}),e.jsx(m.Content,{value:"published",children:e.jsx(S,{layout:b})})]}),e.jsx(c.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:e.jsx(J,{})})]})]}),e.jsx(K,{onProceed:i})]})})]})},E=W(m.Trigger)`
  text-transform: uppercase;
`,ue=(a,n)=>{const o=a?.status,s=n?.availableStatus??[];return o?o==="draft"&&s.find(t=>t.publishedAt!==null)?"published":o:"draft"},ye=()=>{const{slug:a=""}=X(),{permissions:n=[],isLoading:o,error:s}=Z(ae.map(t=>({action:t,subject:a})));return o?e.jsx(d.Loading,{}):s||!a?e.jsx(d.Error,{}):e.jsx(d.Protect,{permissions:n,children:({permissions:t})=>e.jsx(ee,{permissions:t,children:e.jsx(ce,{})})})};export{ce as EditViewPage,ye as ProtectedEditViewPage};
