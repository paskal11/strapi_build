const __vite__fileDeps=["index-CZ3rXZbR-BHRR69Qk.js","strapi-60hOZl5W.js","strapi-COJtagOC.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{g as f,fm as q,fn as k,fo as Ge,d as Y,r as y,bz as He,fp as Ne,aP as O,u as v,fq as d,j as e,P as A,R as _e,a as je,B as Q,T as ee,ar as We,fr as Ke,aq as Se,bp as ke,fs as Je,ft as P,fu as Ze,fv as Xe,fw as Ye,fx as es,fy as ss,fz as E,fA as ts,b as $,ab as Le,fB as as,I as W,b8 as os,bx as Re,d5 as ns,fC as is,dv as rs,bg as ls,fD as ds,fE as cs,S as Z,fF as us,H as fs,fG as gs,fH as ps,F as U,V as hs,b4 as xs,fI as ms,aS as K,fJ as js,fK as bs,fL as ys,fM as vs,fN as Fs,c3 as Cs,U as L,bf as X,an as be,ao as Ms,fO as Ss,fP as ye,fQ as ks,fR as Ls,c as Rs,a4 as As,a5 as ws,fS as Es,bk as ve,bj as Ts,bl as Ds,M as b,dr as Bs,fT as Is,aT as Ps,O as $s,Q as qs,W as Fe,fU as Os,o as Qs,n as Us,q as zs,y as Vs,fV as J,fW as Gs,eN as Hs}from"./strapi-60hOZl5W.js";const Ns=(s,{pathname:a,query:o})=>{let n=[{id:null,label:{id:d("plugin.name"),defaultMessage:"Media Library"},href:s?E(a,o):void 0}];return s?.parent?.parent&&n.push([]),s?.parent&&n.push({id:s.parent.id,label:s.parent.name,href:E(a,o,{folder:s.parent.id,folderPath:s.parent.path})}),s&&n.push({id:s.id,label:s.name}),n},_s=s=>{const{id:a}=vs();return e.jsx(Q,{position:"relative",zIndex:2,children:e.jsx(Le,{"aria-labelledby":`${a}-title`,...s})})},Ae=({selected:s,onSuccess:a})=>{const{formatMessage:o}=v(),{remove:n}=Es(),i=async()=>{await n(s),a()};return e.jsxs(ve.Root,{children:[e.jsx(ve.Trigger,{children:e.jsx(L,{variant:"danger-light",size:"S",startIcon:e.jsx(Ts,{}),children:o({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Ds,{onConfirm:i})]})};Ae.propTypes={selected:f.arrayOf(q,k).isRequired,onSuccess:f.func.isRequired};const Ws=()=>{const{formatMessage:s}=v(),{toggleNotification:a}=Qs(),o=Us(),{post:n}=zs(),r=Vs(({destinationFolderId:h,filesAndFolders:g})=>{const c=g.reduce((u,M)=>{const{id:l,type:S}=M,x=S==="asset"?"fileIds":"folderIds";return u[x]||(u[x]=[]),u[x].push(l),u},{});return n("/upload/actions/bulk-move",{...c,destinationFolderId:h})},{onSuccess(h){const{data:{data:g}}=h;g?.files?.length>0&&(o.refetchQueries([J,"assets"],{active:!0}),o.refetchQueries([J,"asset-count"],{active:!0})),o.refetchQueries([J,"folders"],{active:!0}),a({type:"success",message:s({id:d("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...r,move:(h,g)=>r.mutateAsync({destinationFolderId:h,filesAndFolders:g})}},se=({onClose:s,selected:a,currentFolder:o})=>{const{formatMessage:n}=v(),{data:i,isLoading:r}=Is(),{move:p}=Ws();if(!i)return null;const h=async(c,{setErrors:u})=>{try{await p(c.destination.value,a),s()}catch(M){const S=Gs(M).errors.reduce((x,T)=>(x[T.values?.path?.length||"destination"]=T.defaultMessage,x),{});Hs(S)||u(S)}};if(r)return e.jsx(b.Content,{children:e.jsx(b.Body,{children:e.jsx(U,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(Ps,{children:n({id:d("content.isLoading"),defaultMessage:"Content is loading."})})})})});const g={destination:{value:o?.id||"",label:o?.name||i[0].label}};return e.jsx(b.Content,{children:e.jsx($s,{validateOnChange:!1,onSubmit:h,initialValues:g,children:({values:c,errors:u,setFieldValue:M})=>e.jsxs(qs,{noValidate:!0,children:[e.jsx(b.Header,{children:e.jsx(b.Title,{children:n({id:d("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(b.Body,{children:e.jsx(Z.Root,{gap:4,children:e.jsx(Z.Item,{xs:12,col:12,direction:"column",alignItems:"stretch",children:e.jsxs(Fe.Root,{id:"folder-destination",children:[e.jsx(Fe.Label,{children:n({id:d("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(Os,{options:i,onChange:l=>{M("destination",l)},defaultValue:c.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:u?.destination,ariaErrorMessage:"destination-error"}),u.destination&&e.jsx(ee,{variant:"pi",tag:"p",textColor:"danger600",children:u.destination})]})})})}),e.jsxs(b.Footer,{children:[e.jsx(b.Close,{children:e.jsx(L,{variant:"tertiary",name:"cancel",children:n({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(L,{type:"submit",loading:r,children:n({id:"modal.folder.move.submit",defaultMessage:"Move"})})]})]})})})};se.defaultProps={currentFolder:void 0,selected:[]};se.propTypes={onClose:f.func.isRequired,currentFolder:k,selected:f.arrayOf(k,q)};const te=({selected:s,onSuccess:a,currentFolder:o})=>{const{formatMessage:n}=v(),[i,r]=y.useState(!1),p=()=>{r(!1),a()};return e.jsxs(b.Root,{open:i,onOpenChange:r,children:[e.jsx(b.Trigger,{children:e.jsx(L,{variant:"secondary",size:"S",startIcon:e.jsx(Bs,{}),children:n({id:"global.move",defaultMessage:"Move"})})}),e.jsx(se,{currentFolder:o,onClose:p,selected:s})]})};te.defaultProps={currentFolder:void 0,selected:[]};te.propTypes={onSuccess:f.func.isRequired,currentFolder:k,selected:f.arrayOf(q,k)};const ae=({selected:s,onSuccess:a,currentFolder:o})=>{const{formatMessage:n}=v();return e.jsxs(U,{gap:2,paddingBottom:5,children:[e.jsx(ee,{variant:"epsilon",textColor:"neutral600",children:n({id:d("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:s.filter(({type:i})=>i==="folder").length,numberAssets:s.filter(({type:i})=>i==="asset").length})}),e.jsx(Ae,{selected:s,onSuccess:a}),e.jsx(te,{currentFolder:o,selected:s,onSuccess:a})]})};ae.defaultProps={currentFolder:void 0,selected:[]};ae.propTypes={onSuccess:f.func.isRequired,currentFolder:k,selected:f.arrayOf(q,k)};const Ks=({isFiltering:s,canCreate:a,canRead:o})=>s?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:o?a?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},we=({canCreate:s,isFiltering:a,canRead:o,onActionClick:n})=>{const{formatMessage:i}=v(),r=Ks({isFiltering:a,canCreate:s,canRead:o});return e.jsx(Fs,{icon:o?void 0:Cs,action:s&&!a&&e.jsx(L,{variant:"secondary",startIcon:e.jsx(X,{}),onClick:n,children:i({id:d("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:i({...r,id:d(r.id)})})};we.propTypes={canCreate:f.bool.isRequired,canRead:f.bool.isRequired,isFiltering:f.bool.isRequired,onActionClick:f.func.isRequired};const Js=()=>{const[s,a]=y.useState(!1),{formatMessage:o}=v(),{trackUsage:n}=ke(),[{query:i},r]=O(),p=i?.filters?.$and||[],h=c=>{r({filters:{$and:c},page:1})},g=c=>{n("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(c[c.length-1])[0]}),r({filters:{$and:c},page:1})};return e.jsxs(be.Root,{open:s,onOpenChange:a,children:[e.jsx(be.Trigger,{children:e.jsx(L,{variant:"tertiary",startIcon:e.jsx(Ms,{}),size:"S",children:o({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(Ss,{displayedFilters:ye,filters:p,onSubmit:g,onToggle:a}),e.jsx(ks,{appliedFilters:p,filtersSchema:ye,onRemoveFilter:h})]})},oe=({breadcrumbs:s,canCreate:a,folder:o,onToggleEditFolderDialog:n,onToggleUploadAssetDialog:i})=>{const{formatMessage:r}=v(),{pathname:p}=Se(),[{query:h}]=O(),g={...h,folder:o?.parent?.id??void 0,folderPath:o?.parent?.path??void 0};return e.jsx($.Header,{title:r({id:d("plugin.name"),defaultMessage:"Media Library"}),subtitle:s&&o&&e.jsx(Ls,{tag:"nav",label:r({id:d("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:s,currentFolderId:o?.id}),navigationAction:o&&e.jsx(Rs,{tag:As,startIcon:e.jsx(ws,{}),to:`${p}?${Re.stringify(g,{encode:!1})}`,children:r({id:d("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:a&&e.jsxs(U,{gap:2,children:[e.jsx(L,{startIcon:e.jsx(X,{}),variant:"secondary",onClick:n,children:r({id:d("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(L,{startIcon:e.jsx(X,{}),onClick:i,children:r({id:d("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})};oe.defaultProps={breadcrumbs:!1,folder:null};oe.propTypes={breadcrumbs:f.oneOfType([Ge,f.bool]),canCreate:f.bool.isRequired,folder:k,onToggleEditFolderDialog:f.func.isRequired,onToggleUploadAssetDialog:f.func.isRequired};const Zs=Y(Q)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,Ce=Y(ee)`
  max-width: 100%;
`,Me=Y(Q)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }
`,Xs=()=>{const s=We(),{canRead:a,canCreate:o,canUpdate:n,canCopyLink:i,canDownload:r,canConfigureView:p,isLoading:h}=Ke(),g=y.useRef(),{formatMessage:c}=v(),{pathname:u}=Se(),{trackUsage:M}=ke(),[{query:l},S]=O(),x=!!(l._q||l.filters),[T,Ee]=Je(Ze.view,P.GRID),R=T===P.GRID,{data:F,isLoading:Te,errors:De}=Xe({skipWhen:!a,query:l}),{data:Be,isLoading:Ie,errors:Pe}=Ye({enabled:a&&F?.pagination?.page===1&&!es(l),query:l}),{data:z,isLoading:ne,error:$e}=ss(l?.folder,{enabled:a&&!!l?.folder});$e?.response?.status===404&&s(u);const D=Be?.map(t=>({...t,type:"folder",folderURL:E(u,l,t.id),isSelectable:n}))??[],m=D?.length||0,B=F?.results?.map(t=>({...t,type:"asset",isSelectable:n}))||[],j=B?.length??0,qe=F?.pagination?.total,Oe=ne||Ie||h||Te,[ie,Qe]=y.useState(!1),[re,le]=y.useState(!1),[V,G]=y.useState(void 0),[H,de]=y.useState(void 0),[C,{selectOne:I,selectAll:ce}]=ts(["type","id"],[]),ue=C?.length>0&&C?.length!==j+m,N=()=>Qe(t=>!t),fe=({created:t=!1}={})=>{t&&l?.page!=="1"&&S({...l,page:1}),le(w=>!w)},ge=(t,w)=>{t&&M("didSelectAllMediaLibraryElements"),ce(w)},pe=t=>{M("didSortMediaLibraryElements",{location:"upload",sort:t}),S({sort:t})},he=t=>{de(t),le(!0)},Ue=t=>{de(null),fe(t),g.current&&g.current.focus()},xe=t=>{t===j&&F.pagination.page===F.pagination.pageCount&&F.pagination.page>1&&S({...l,page:F.pagination.page-1})},ze=()=>{ce(),xe(C.length)};return Oe?e.jsx(A.Loading,{}):De||Pe?e.jsx(A.Error,{}):e.jsxs($.Root,{children:[e.jsxs(A.Main,{children:[e.jsx(oe,{breadcrumbs:!ne&&Ns(z,{pathname:u,query:l}),canCreate:o,onToggleEditFolderDialog:fe,onToggleUploadAssetDialog:N,folder:z}),e.jsx($.Action,{startActions:e.jsxs(e.Fragment,{children:[n&&R&&(j>0||m>0)&&e.jsx(Zs,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(Le,{"aria-label":c({id:d("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:ue?"indeterminate":(j>0||m>0)&&C.length===j+m,onCheckedChange:t=>ge(t,[...B,...D])})}),a&&R&&e.jsx(as,{value:l?.sort,onChangeSort:pe}),a&&e.jsx(Js,{})]}),endActions:e.jsxs(e.Fragment,{children:[p?e.jsx(Me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{tag:os,to:{pathname:`${u}/configuration`,search:Re.stringify(l,{encode:!1})},label:c({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(ns,{})})}):null,e.jsx(Me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{label:c(R?{id:d("view-switch.list"),defaultMessage:"List View"}:{id:d("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>Ee(R?P.LIST:P.GRID),children:R?e.jsx(is,{}):e.jsx(rs,{})})}),e.jsx(ls,{label:c({id:d("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs($.Content,{children:[C.length>0&&e.jsx(ae,{currentFolder:z,selected:C,onSuccess:ze}),m===0&&j===0&&e.jsx(we,{canCreate:o,canRead:a,isFiltering:x,onActionClick:N}),a&&!R&&(j>0||m>0)&&e.jsx(ds,{assetCount:j,folderCount:m,indeterminate:ue,onChangeSort:pe,onChangeFolder:(t,w)=>s(E(u,l,{folder:t,folderPath:w})),onEditAsset:G,onEditFolder:he,onSelectOne:I,onSelectAll:ge,rows:[...D,...B],selected:C,shouldDisableBulkSelect:!n,sortQuery:l?.sort??""}),a&&R&&e.jsxs(e.Fragment,{children:[m>0&&e.jsx(cs,{title:(x&&j>0||!x)&&c({id:d("list.folders.title"),defaultMessage:"Folders ({count})"},{count:m})||"",children:D.map(t=>{const Ve=!!C.filter(({type:_})=>_==="folder").find(_=>_.id===t.id),me=E(u,l,{folder:t?.id,folderPath:t?.path});return e.jsx(Z.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(us,{ref:H&&t.id===H.id?g:void 0,ariaLabel:t.name,id:`folder-${t.id}`,to:me,startAction:I&&t.isSelectable?e.jsx(_s,{"data-testid":`folder-checkbox-${t.id}`,checked:Ve,onCheckedChange:()=>I(t)}):null,cardActions:e.jsx(W,{"aria-label":c({id:d("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>he(t),children:e.jsx(fs,{})}),children:e.jsx(gs,{children:e.jsx(ps,{to:me,children:e.jsxs(U,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs(Ce,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[t.name,e.jsx(hs,{children:":"})]}),e.jsx(Ce,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:c({id:d("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:t.children.count,filesCount:t.files.count})})]})})})})},`folder-${t.id}`)})}),j>0&&m>0&&e.jsx(Q,{paddingTop:6,paddingBottom:4,children:e.jsx(xs,{})}),j>0&&e.jsx(ms,{assets:B,onEditAsset:G,onSelectAsset:I,selectedAssets:C.filter(({type:t})=>t==="asset"),title:(!x||x&&m>0)&&F?.pagination?.page===1&&c({id:d("list.assets.title"),defaultMessage:"Assets ({count})"},{count:qe})||""})]}),e.jsxs(K.Root,{...F.pagination,children:[e.jsx(K.PageSize,{}),e.jsx(K.Links,{})]})]})]}),ie&&e.jsx(js,{open:ie,onClose:N,trackedLocation:"upload",folderId:l?.folder}),re&&e.jsx(bs,{open:re,onClose:Ue,folder:H,parentFolderId:l?.folder,location:"upload"}),V&&e.jsx(ys,{onClose:t=>{t===null&&xe(1),G(void 0)},open:!!V,asset:V,canUpdate:n,canCopyLink:i,canDownload:r,trackedLocation:"upload"})]})},Ys=y.lazy(()=>He(()=>import("./index-CZ3rXZbR-BHRR69Qk.js"),__vite__mapDeps([0,1,2]))),st=()=>{const{config:{isLoading:s,isError:a,data:o}}=Ne(),[{rawQuery:n},i]=O(),{formatMessage:r}=v(),p=r({id:d("plugin.name"),defaultMessage:"Media Library"});return y.useEffect(()=>{s||a||n||i({sort:o.sort,page:1,pageSize:o.pageSize})},[s,a,o,n,i]),s?e.jsxs(e.Fragment,{children:[e.jsx(A.Title,{children:p}),e.jsx(A.Loading,{})]}):e.jsx(A.Main,{children:n?e.jsx(y.Suspense,{fallback:e.jsx(A.Loading,{}),children:e.jsxs(_e,{children:[e.jsx(je,{index:!0,element:e.jsx(Xs,{})}),e.jsx(je,{path:"configuration",element:e.jsx(Ys,{config:o})})]})}):null})};export{st as default};
